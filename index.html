<!DOCTYPE html>
<html lang="es">
<head>
  <base href="." />
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Control de Stock - Paquetes</title>
  <style>
    :root {
      --primary: #2196f3;
      --background: #ffffff;
      --text: #333333;
      --card-bg: #f5f5f5;
      --shadow: rgba(0,0,0,0.1);
    }

    [data-theme="dark"] {
      --primary: #64b5f6;
      --background: #1a1a1a;
      --text: #ffffff;
      --card-bg: #333333;
      --shadow: rgba(255,255,255,0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      transition: all 0.3s ease;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--background);
      color: var(--text);
      min-height: 100vh;
      padding: 20px;
    }

    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      cursor: pointer;
      font-size: 1.5rem;
      background: none;
      border: none;
      color: var(--text);
    }

    .info-icon {
      position: fixed;
      top: 20px;
      left: 20px;
      cursor: pointer;
      font-size: 1.5rem;
      background: none;
      border: none;
      color: var(--text);
    }

    .container {
      max-width: 1200px;
      margin: 60px auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      padding: 20px;
    }

    .package-card {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      box-shadow: 0 4px 6px var(--shadow);
      position: relative;
    }

    .package-count {
      font-size: 2rem;
      font-weight: bold;
      margin: 10px 0;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    button {
      padding: 8px 16px;
      border: none;
      border-radius: 5px;
      background: var(--primary);
      color: white;
      cursor: pointer;
    }

    button:hover {
      opacity: 0.9;
    }

    .reset-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 4px 8px;
      font-size: 0.8rem;
      background: #ff5252;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: var(--card-bg);
      padding: 30px;
      border-radius: 10px;
      max-width: 500px;
      width: 90%;
      position: relative;
    }

    .close-modal {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      font-size: 1.5rem;
    }

    .package-info {
      margin-top: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 40px;
      color: var(--primary);
    }
  </style>
</head>
<body>
  <h1>Control de Stock</h1>
  <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
  <button class="info-icon" onclick="resetAll()">‚ÑπÔ∏è</button>

  <div class="container" id="packageContainer">
    <!-- Los paquetes se generar√°n din√°micamente -->
  </div>

  <div class="modal" id="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal()">√ó</span>
      <h2 id="modalTitle"></h2>
      <div id="modalContent" class="package-info"></div>
    </div>
  </div>

  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    const API_KEY = 'AIzaSyAVqbd_5YlVQmwP9m9q40N51Pp3tS7G780'; // Reemplaza con tu clave de API
    const SHEET_ID = '1MY9uAzjpo4hz1DvfkfY6GkswxYMSjssvYB9FN_M1X9I'; // Reemplaza con el ID de tu hoja de c√°lculo

    const packages = [
      {
        name: "Paquete Rojooo",
        color: "#ff5252",
        count: 0,
        description: "Paquete premium con entrega prioritaria. Incluye seguimiento en tiempo real y garant√≠a de entrega en 24 horas.",
        dimensions: "30cm x 20cm x 15cm",
        maxWeight: "5kg"
      },
      {
        name: "Paquete Azul",
        color: "#2196f3",
        count: 0,
        description: "Paquete est√°ndar con entrega en 48-72 horas. Incluye seguro b√°sico de env√≠o.",
        dimensions: "25cm x 15cm x 10cm",
        maxWeight: "3kg"
      },
      {
        name: "Paquete Verde",
        color: "#4caf50",
        count: 0,
        description: "Paquete eco-friendly con embalaje reciclable. Ideal para env√≠os no urgentes.",
        dimensions: "20cm x 15cm x 10cm",
        maxWeight: "2kg"
      },
    ];

    function createPackageCards() {
      const container = document.getElementById('packageContainer');
      packages.forEach((pkg, index) => {
        const card = document.createElement('div');
        card.className = 'package-card';
        card.style.borderLeft = `5px solid ${pkg.color}`;
        card.onclick = () => showModal(index);
        
        card.innerHTML = `
          <h3>${pkg.name}</h3>
          <div class="package-count" id="count-${index}">${pkg.count}</div>
          <div class="controls">
            <button onclick="updateCount(${index}, -1); event.stopPropagation();">-</button>
            <button onclick="updateCount(${index}, 1); event.stopPropagation();">+</button>
          </div>
          <button class="reset-btn" onclick="resetPackage(${index}); event.stopPropagation();">Reset</button>
        `;
        
        container.appendChild(card);
      });
    }

    function updateCount(index, change) {
      packages[index].count = Math.max(0, packages[index].count + change);
      document.getElementById(`count-${index}`).textContent = packages[index].count;

      // Actualiza Google Sheets
      updateGoogleSheet(index, packages[index].count);

      saveToLocalStorage();
    }

    function resetPackage(index) {
      packages[index].count = 0;
      document.getElementById(`count-${index}`).textContent = 0;

      // Actualiza Google Sheets
      updateGoogleSheet(index, packages[index].count);

      saveToLocalStorage();
    }

    function resetAll() {
      if (confirm('¬øEst√°s seguro de que deseas reiniciar todos los contadores?')) {
        packages.forEach((pkg, index) => {
          pkg.count = 0;
          document.getElementById(`count-${index}`).textContent = 0;

          // Actualiza Google Sheets
          updateGoogleSheet(index, packages[index].count);
        });
        saveToLocalStorage();
      }
    }

    function showModal(index) {
      const modal = document.getElementById('modal');
      const modalTitle = document.getElementById('modalTitle');
      const modalContent = document.getElementById('modalContent');
      const pkg = packages[index];
      
      modalTitle.textContent = pkg.name;
      modalContent.innerHTML = `
        <p><strong>Descripci√≥n:</strong> ${pkg.description}</p>
        <p><strong>Dimensiones:</strong> ${pkg.dimensions}</p>
        <p><strong>Peso m√°ximo:</strong> ${pkg.maxWeight}</p>
        <p><strong>Cantidad actual:</strong> ${pkg.count}</p>
      `;
      
      modal.style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('modal').style.display = 'none';
    }

    function toggleTheme() {
      document.body.dataset.theme = document.body.dataset.theme === 'dark' ? 'light' : 'dark';
      saveThemePreference();
    }

    function saveThemePreference() {
      localStorage.setItem('theme', document.body.dataset.theme);
    }

    function loadThemePreference() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        document.body.dataset.theme = savedTheme;
      }
    }

    function saveToLocalStorage() {
      localStorage.setItem('packages', JSON.stringify(packages));
    }

    function loadFromLocalStorage() {
      const savedPackages = localStorage.getItem('packages');
      if (savedPackages) {
        const parsedPackages = JSON.parse(savedPackages);
        parsedPackages.forEach((pkg, index) => {
          packages[index].count = pkg.count;
          document.getElementById(`count-${index}`).textContent = pkg.count;
        });
      }
    }

    function updateGoogleSheet(index, count) {
      const params = {
        spreadsheetId: SHEET_ID,
        range: `Control de Stock!A${index + 2}`, // Usa el nombre correcto de la hoja
        valueInputOption: 'USER_ENTERED',
        resource: {
          values: [
            [count],
          ],
        },
      };
      const request = gapi.client.sheets.spreadsheets.values.update(params);
      request.then(response => {
        console.log(`Updated cell: ${response.result.updatedCells} cells updated.`);
      }, error => {
        console.error('Error updating sheet:', error);
      });
    }

    function initGAPI() {
      gapi.load('client', () => {
        gapi.client.init({
          apiKey: API_KEY,
          discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
        }).then(() => {
          loadFromLocalStorage();
        });
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadThemePreference();
      createPackageCards();
      initGAPI();
    });
  </script>
</body>
</html>
